<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<meta charset="UTF-8">
<head>
  <meta charset="UTF-8">
  <!-- 필요한 스타일시트 및 스크립트 로드 -->

  <!-- 부트스트랩 스타일시트 추가 -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

  <!-- Font Awesome 스타일시트 추가 -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css">

  <!-- 추가적인 CSS 스타일 추가 -->
  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }

    .book-box {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 10px;
      margin: 10px;
      border-radius: 5px;
    }

    #searchInput {
      width: 70%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }

    #searchButton {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }

    #searchButton i {
      font-size: 18px;
    }

    .book-table {
      width: 100%;
      border-collapse: collapse;
    }

    .book-table th,
    .book-table td {
      border: none; /* 칼럼 간의 구분선 제거 */
      padding: 24px; /* 각 행에 대한 세로 크기 3배로 증가 */
      text-align: left;
    }

    /* 스타일 수정 - 현재 페이지 페이징에 'active' 클래스 적용 */
    .pagination .page-item.active .page-link {
      background-color: #110f0f;
      color: #6dc571;
    }
  </style>
</head>
<body>
<script>
  function deleteBook(bookId) {
    // JSON 데이터를 생성
    let data = {
      bookId: bookId
    };

    // 서버로 POST 요청을 보냄
    fetch('/api/mainPage', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(data)
    })
            .then(response => {
              if (response.ok) {
                // 성공적으로 처리된 경우의 로직을 여기에 추가
                window.location.href = '/api/mainPage';
                alert('도서 정보가 성공적으로 삭제되었습니다.');
              } else {
                // 오류 처리 로직을 여기에 추가
                alert('도서 정보 삭제 중 오류가 발생했습니다.');
              }
            })
            .catch(error => {
              // 네트워크 오류 등의 예외 처리
              console.error('요청을 보내는 중 오류가 발생했습니다.', error);
              alert('도서 정보 삭제 중 오류가 발생했습니다.');
            });
    location.reload();
  }
</script>

<div class="container">
  <div class="row">
    <div class="col-8">
      <form th:action="@{/api/bookSearch}" method="get">
        <input type="text" id="searchInput" placeholder="도서 검색" name="searchWord">
        <button id="searchButton" type="submit">
          <i class="fa fa-search"></i>
        </button>
      </form>
    </div>
    <!-- 도서 추가 버튼 -->
    <div class="col-4 text-right">
      <a th:href="@{/admin/createBook}" class="btn btn-primary">도서 추가</a>
    </div>
  </div>
  <div class="row">
    <table class="book-table">
      <thead>
      <tr>
        <th>도서 제목</th>
        <th>저자</th>
        <th>출판사</th>
        <th>출판일</th>
        <th>판매 가격</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="book : ${paging}" class="book-box">
        <td>
          <a th:href="@{/admin/book-detail(bookId=${book.bookId})}">[[${book.bookTitle}]]</a>
        </td>
        <td th:text="${book.author}"></td>
        <td th:text="${book.publisher}"></td>
        <td th:text="${#temporals.format(book.publishDate, 'yyyy년 MM월 dd일')}"></td>
        <td th:text="${book.salesPrice}"></td>
        <td>
          <button class="delete-button" data-bookId="${book.bookId}" th:onclick="|deleteBook(${book.bookId});|">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
  <!-- 페이지 번호를 표시하는 부분 -->
  <div class="row">
    <div class="col-12">
      <ul class="pagination">
        <li th:if="${paging.hasPrevious()}" class="page-item">
          <a th:href="@{/api/mainPage(page=0)}" class="page-link">처음</a>
        </li>
        <li th:if="${paging.hasPrevious()}" class="page-item">
          <a th:href="@{/api/mainPage(page=${paging.number - 1})}" class="page-link">이전</a>
        </li>
        <li th:each="i : ${#numbers.sequence(0, paging.totalPages - 1)}"
             th:classappend="(${i} == ${paging.number}) ? 'active' : '' ">
          <a th:href="@{/api/mainPage(page=${i})}" class="page-link" th:text="${i + 1}"></a>
        </li>
        <li th:if="${paging.hasNext()}" class="page-item">
          <a th:href="@{/api/mainPage(page=${paging.number + 1})}" class="page-link">다음</a>
        </li>
        <li th:if="${paging.hasNext()}" class="page-item">
          <a th:href="@{/api/mainPage(page=${paging.totalPages - 1})}" class="page-link">마지막</a>
        </li>
      </ul>
    </div>
  </div>
</div>
</body>
</html>